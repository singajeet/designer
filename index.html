<!DOCTYPE html>
<html style='height:100%;width:100%'>
  <head>
    <title>Page Title</title>
    <meta charset="utf-1">
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="designer.css">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/subjx.css" >
    <link rel="stylesheet" href="css/w2ui.min.css" >
    <!-- <link rel="stylesheet" href="css/font-awesome.min.css" > -->
    <link rel="stylesheet" href="css/fontawesome/css/all.min.css" >
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/subjx.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/prototype.js"></script>
    <script src="js/d3.min.js"></script>
    <!-- <script src="https://d3js.org/d3.v5.js"></script> -->
    <script src="designer.js" ></script>
  	<script>
  		var $j = jQuery.noConflict();
  	</script>
    <script src="js/w2ui.min.js"></script>
  </head>
  <body style='height: 100%; width: 100%; overflow: hidden;'> <!--height:auto;max-width:100%;-->

	  <script>

	    $j(document).ready(function(){
		    try{
          var projectId = '';
          var dbConnection = null;

          var projectNavigator = new ProjectNavigator('projectNavigator', initializeParentCallback, itemAddedCallback, itemRemovedCallback, itemSelectedCallback, initializeContextMenuCallback, contextMenuItemSelectedCallback);

		    	var c = new Canvas('canvas_grid');
          var a = new Application('app', c, projectNavigator);
          a.addNewProjectEventListener(onNewProject);

          var edgesGroup = new ToolGroup('edges_group', 'Edges');
          var nodesGroup = new ToolGroup('nodes_group', 'Nodes');
          var flowchartGroup = new ToolGroup('flowchart_group', 'Flowchart');
          var databaseGroup = new ToolGroup('database_group', 'Database');

          var toolbox = new ToolBox('tool_box', c);

          var lineTool = new Line('LineTool', c);
      	  var rectTool = new Rectangle('RectTool', c);
      	  var circTool = new Circle('CircTool', c);
      	  var ellipTool = new Ellipse('EllipTool', c);
      	  var polyTool = new Polygon('PolyTool', c);
      	  var polylineTool = new Polyline('PolylineTool', c);
          var bezireCurve = new BezireCurve('bezireCurve', c);
          var nodeTool = new BasicNode('NodeTool', c);

          var fcTerminatorTool = new FlowChartTerminator('FCTermTool', c);
          var fcProcessTool = new FlowChartProcess('FCProcTool', c);
          var fcDecisionTool = new FlowChartDecision('FCDecisionTool', c);
          var fcDocumentTool = new FlowChartDocument('FCDocTool', c);
          var fcSubroutineTool = new FlowChartSubroutine('FCSubTool', c);
          var fcDelayTool = new FlowChartDelay('FCDelayTool', c);
          var fcDataTool = new FlowChartData('FCDataTool', c);
          var fcMultiDocTool = new FlowChartMultiDocument('FCMultiDocTool', c);
          var fcPrepTool = new FlowChartPreparation('FCPrepTool', c);
          var fcDispTool = new FlowChartDisplay('FCDispTool', c);
          var fcInputTool = new FlowChartInput('FCInputTool', c);
          var fcLoopTool = new FlowChartLoop('FCLoopTool', c);
          var fcLoopLimitTool = new FlowChartLoopLimit('FCLoopLimitTool', c);
          var fcStoredDataTool = new FlowChartStoredData('FCStoredDataTool', c);
          var fcConnectorTool = new FlowChartConnector('FCConnectorTool', c);
          var fcOffPgConnTool = new FlowChartOffPageConnector('FCOffPgConn', c);
          var fcORTool = new FlowChartOR('FCORTool', c);
          var fcANDTool = new FlowChartAND('FCANDTool', c);
          var fcCollateTool = new FlowChartCollate('FCCollateTool', c);
          var fcSortTool = new FlowChartSort('FCSortTool', c);
          var fcMergeTool = new FlowChartMerge('FCMergeTool', c);
          var fcIntStorageTool = new FlowChartInternalStorage('FCIntStorageTool', c);
          var fcDBTool =  new FlowChartDatabase('FCDBTool', c);

          var dbTable = new DatabaseTable('DBTable', c);

          edgesGroup.addTool(lineTool);
          edgesGroup.addTool(polylineTool);
          edgesGroup.addTool(bezireCurve);

          nodesGroup.addTool(rectTool);
          nodesGroup.addTool(circTool);
          nodesGroup.addTool(ellipTool);
          nodesGroup.addTool(polyTool);
          nodesGroup.addTool(nodeTool);

          flowchartGroup.addTool(fcTerminatorTool);
          flowchartGroup.addTool(fcProcessTool);
          flowchartGroup.addTool(fcDecisionTool);
          flowchartGroup.addTool(fcDocumentTool);
          flowchartGroup.addTool(fcSubroutineTool);
          flowchartGroup.addTool(fcDelayTool);
          flowchartGroup.addTool(fcDataTool);
          flowchartGroup.addTool(fcMultiDocTool);
          flowchartGroup.addTool(fcPrepTool);
          flowchartGroup.addTool(fcDispTool);
          flowchartGroup.addTool(fcInputTool);
          flowchartGroup.addTool(fcLoopTool);
          flowchartGroup.addTool(fcLoopLimitTool);
          flowchartGroup.addTool(fcStoredDataTool);
          flowchartGroup.addTool(fcConnectorTool);
          flowchartGroup.addTool(fcOffPgConnTool);
          flowchartGroup.addTool(fcORTool);
          flowchartGroup.addTool(fcANDTool);
          flowchartGroup.addTool(fcCollateTool);
          flowchartGroup.addTool(fcSortTool);
          flowchartGroup.addTool(fcMergeTool);
          flowchartGroup.addTool(fcIntStorageTool);
          flowchartGroup.addTool(fcDBTool);

          databaseGroup.addTool(dbTable);

          toolbox.addGroup(edgesGroup);
          toolbox.addGroup(nodesGroup);
          toolbox.addGroup(flowchartGroup);
          toolbox.addGroup(databaseGroup);

          c.setToolBox(toolbox);

          a.render();

          function initializeParentCallback(navigator) {
            navigator.add([
                { id: 'projects', text: 'Projects', img: 'icon-folder', expanded: true, group: true}
              ]);
          }

          function itemAddedCallback(navigator, item) {
            if(item.toolName === 'LINE' || item.toolName === 'POLYLINE' || item.toolName === 'BEZIRE_CURVE') {
              navigator.insert(projectId + '-edges', null, [{id: item.id, text: item.id + ' - ' + item.toolName}]);
            } else {
              navigator.insert(projectId + '-nodes', null, [{id: item.id, text: item.id + ' - ' + item.toolName}]);
            }
          }

          function itemRemovedCallback(navigator, item) {
            navigator.remove(item.id);
          }

          function itemSelectedCallback(navigator, item) {
            console.log('Item Selected: ' + item);
          }

          function initializeContextMenuCallback(navigator) {
            navigator.menu = [
              { id: 'add-db-connection', text: 'Add Connection', img: 'fas fa-plus'},
              { id: 'delete-db-connection', text: 'Delete Connection', img: 'fas fa-minus'},
              { id: 'sep-1', text: '--'},
              { id: 'add-table', text: 'Add Table', img: ''},
              { id: 'add-view', text: 'Add View', img: ''},
              { id: 'add-materialized-view', text: 'Add Materialized View', img: ''},
              { id: 'add-package', text: 'Add Package', img: ''},
              { id: 'sep-2', text: '--'},
              { id: 'delete-db-object', text: 'delete Object', img: 'fas fa-minus'}
            ];
          }

          function contextMenuItemSelectedCallback(navigator, item) {
            if(item === 'add-db-connection') {
              dbConnection = new DatabaseConnection();
              dbConnection.promptConnection();
            }
          }

          function onNewProject(navigator, project) {
            projectId = project + '-project';
            navigator.insert('projects', null, [{id: projectId, text: project, icon: 'fas fa-drafting-compass',
                            nodes: [
                              { id: projectId + '-edges', text: 'Edges', img: 'icon-folder'},
                              { id: projectId + '-nodes', text: 'Nodes', img: 'icon-folder'}
                            ]
                          }]);
          }

		    }catch(err){
			    alert(err.stack);
			    console.log(err);
			    console.log(err.stack);
		    }
	    });
    </script>
  </body>
</html>
